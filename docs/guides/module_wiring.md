# Module Wiring ガイド

この文書は `module-wiring-lint` の警告を解釈し、プロジェクト内で一貫したモジュール構成を維持するための運用ルールをまとめたものです。実装時は以下の方針に従ってください。

## 基本方針

- **モジュール内部では FQCN での `use` を優先する**
  - 例: `use crate::foo::bar::Baz;`
  - 再エクスポート (`pub use`) を安易に増やさず、必要なシンボルは利用側で明示的にインポートする。

- **ユーザ向け API には prelude を検討する**
  - 利用者が使いやすいよう、`prelude` モジュールで再エクスポートをまとめるのは許容される。
  - ただし prelude は **ユーザ向けの公開窓口** と位置付け、ランタイム内部では FQCN を使った明示的な `use` を基本とする。

- **末端モジュールの直属親のみ再エクスポートを許可**
  - `mod child;` と `pub use child::{TypeA, TypeB};` が同じモジュールに共存していて、`child` が末端モジュール（子 `mod` を持たない）である場合のみ再エクスポートを認める。
  - `pub use child::*;` も同条件で許可される。
  - `pub use child::Type as Alias;` のようなリネームは避け、必要なら末端モジュール内で別名を定義する。

- **末端判定はソース構造で判断する**
  - パスの階層数ではなく、`child` 配下に更なる `mod` 宣言が存在するかどうかで末端かどうかを決定する。

## `// allow` コメントの使い方

- 警告を意図的に無視する場合は、対象行または直前行に `// allow module_wiring::no_parent_reexport` を記述する。
  - 例: `// allow module_wiring::no_parent_reexport\npub use foo::Bar;`
  - ブロックコメントによる無効化はサポートしていない。

## 運用のコツ

1. **再エクスポートが必要か再検討する**
   - 呼び出し側で `use crate::foo::bar::Baz;` と書ける場合、再エクスポートせずに FQCN を使う方が明瞭。
2. **prelude をユーザ境界に限定する**
   - ランタイム内部やモジュール内では FQCN / 明示的 `use` を心掛ける。
   - 再エクスポートを利用した API の簡略化は外部公開するインターフェースに集中させる。
3. **末端モジュールを維持する**
   - 追加のサブモジュールを定義した場合、再エクスポートを含む親モジュールを見直し、必要なら構成を再設計する。

## 関連資料

- `lints/module-wiring-lint/SPEC.md` – lint の正式仕様
- `docs/sources/protoactor-go`, `docs/sources/apache-pekko` – 参照実装と設計背景

Lint 警告が発生した際は、本書と合わせて `SPEC.md` を確認し、どのルールに違反しているかを把握したうえで対処してください。
